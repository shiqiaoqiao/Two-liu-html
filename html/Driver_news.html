<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="format-detection" content="telephone=no" />
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
<meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT">
<title>我的--我参与的漂流详情</title>
<link rel="stylesheet" href="../css/bootstrap.min.css" />
<link rel="stylesheet" href="../css/style.css" />
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
</head>
<body class="bg_gray">
<header>
        <div class="container pos_rl">
             <div class="row">
                 <div class="col-md-2">
                     <div class="logo">
                        <a href="../index.html"><img src="../image/logo.png" alt="中国童书博览会" /></a>
                     </div>
                 </div>
                 <div class="col-md-8">
                    <div class="nav">
                        <a href="http://book.798artplus.com/html">首页</a>
                        <a href="http://book.798artplus.com/html/html/Books_Drift.html">漂流</a>
                        <a href="../index.html">团队漂流</a>
                        <a class="active" href="Center_people.html">我的</a>
                    </div>
                 </div>
             </div>
             <div class="English"><a href="javascript:;">English</a></div>
        </div>
</header>
<div class="container main">
    <div class="row Books_img_txt lineGray noneInput">
        <div class="col-md-3 col-sm-3 col-xs-3 Book_img mar_b10">
            <a href="javascript:;" class="borderRaduis">
                <img id="userpic" src="../image/b3.jpg" />
            </a>
        </div>
        <div id="peopleTxt" class="col-md-9 col-sm-9 col-xs-9 Important mar_b10">
                <div class="col-md-12">
                     <strong><input id="username" value="贡贺" disabled="true" type="text"></strong>
                     <a href="javascript:;" class="fz12 fr updateBtn">修改</a>
                 </div>
                 <div class="col-md-12 inputBorder">
                     <p>
                         <span style="display:inline-block;">性别：</span>
                         <a href="#" class="Sex" sex="2" select-sex="1">男</a>
                         <a href="#" class="Sex" sex="2" select-sex="0">无</a>
                         <a href="#" class="Sex active" sex="2" select-sex="2">女</a>
                     </p>
                      <span>
                          手机：<input id="userphone" disabled="true" value="15010037251" type="number">
                          <!--<b class='mar_l30'>积分：</b>-->
                      </span>
                     <input class="saveBtn" value="保存" type="button">
                 </div>
        </div>
    </div>
    <div id="bookNews" class="row Books_img_txt">
            <div class="col-md-12 All_Books_tit">
                  <h3>漂流图书状态</h3>
            </div>
            <div class="col-md-3 col-sm-3 col-xs-3 Book_img">
                <a href="javascript:;"><img src="http://ftp.798artplus.com/yangyang/pic/24105696-1_w_6.jpg" /></a>
            </div>
            <div class="col-md-9 col-sm-9 col-xs-9 Important">
                <div class="row">
                     <div class="col-md-12">
                         <strong>我的蔬菜宝宝</strong>
                         <p>
                             <span>作者：猫行者</span><span>出版社：大中小猫出版社</span>
                         </p>
                         <p>内容简介：聚集了全世界各种可爱猫咪</p>
                     </div>
                </div>
            </div>
    </div>
    <div id="driver_more">
           <a href="javascript:;" class="btnJoin1">已寄出</a>
           <a href="javascript:;" class="adressbtn">物流详情</a>
           <span> 对方确认收到三天后退款</span>
           <p class="adressNews">
               <span>已到北京仓库<i>2017-06-25</i></span>
               <span>已送达<i>2017-06-25</i></span>
           </p>
           <div class="clear"></div>
           <a href="javascript:;" class="btnJoin1">邮寄中</a>
           <a href="javascript:;" class="adressbtn">物流详情</a>
           <a href="javascript:;" class="okBtn">确认收货</a>
           <p class="adressNews">
               <span>已到北京仓库<i>2017-06-25</i></span>
               <span>已送达<i>2017-06-25</i></span>
           </p>
           <div class="clear"></div>
           <a href="javascript:;" class="btnJoin1">待寄出</a>
           <a href="NextUser.html" class="adressbtn">查看下一票用户</a>
           <p class="selectadressNews">
           </p>
           <div class="clear"></div>
           <a href="javascript:;" class="btnJoin1">待审批</a>
           <span> 预计2小时候审批</span>
    </div>
</div>
<div class="footer">
      <div class="container">
           <div class="row">
               <div class="col-md-9 col-sm-9">
                   <p>© 2016-2017, 中国童书博览会  all rights reversed.京ICP备16033930号</p>
               </div>
               <div class="col-md-3 col-sm-3 w_img">
                   <img src="../image/weixin.jpg" alt="微信扫描" />
               </div>
           </div>
      </div>
</div>
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/template.js"></script>
<!-- <script type="text/javascript" src="../js/public.js"></script> -->
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=B3f7707c25da5b29a6ff69618788a296"></script>
<!-- <script id="peopleList" type="text/html">
  {{each rows as row i}}
  <div class="col-md-12">
       <strong><input id='username' type="text" value="{{row.nickName}}" disabled="true"/></strong>
       <a href="javascript:;" class="fz12 fr updateBtn">修改</a>
   </div>
   <div class="col-md-12 inputBorder">
       <p>
           <span>性别：</span>
           <a href="#" class="Sex"sex="{{row.sex}}" select-sex="1">男</a>
           <a href="#" class="Sex" sex="{{row.sex}}" select-sex="0">无</a>
           <a href="#" class="Sex" sex="{{row.sex}}" select-sex="2">女</a>
       </p>
        <span>
          手机：<input id="userphone" type="number"  disabled="true" value="{{row.phone}}"/>
          <b class='mar_l30'>积分：{{row.score}}</b>
        </span>
       <input class="saveBtn"  type="button" value="保存" />
   </div>
  {{/each}}
</script>
<script id="bookNews_box" type="text/html">
       <div class="col-md-12 All_Books_tit">
              <h3>漂流图书状态</h3>
        </div>
        <div class="col-md-3 col-sm-3 col-xs-3 Book_img">
            <a href="javascript:;"><img src="{{data.bookimage}}" alt="{{data.bookname}}" /></a>
        </div>
        <div class="col-md-9 col-sm-9 col-xs-9 Important">
            <div class="row">
                 <div class="col-md-12">
                     <strong>{{data.bookname}}</strong>
                     <p>
                         <span>作者：{{data.authorname}}</span><span>出版社：{{data.authorname}}</span>
                     </p>
                     <p>{{data.des}}</p>
                 </div>
            </div>
        </div>
</script>
<script type="text/javascript">
$(document).ready(function(){

    //获取用户信息
    $.ajax({
        url:'http://book.798artplus.com/api/v1/011',
        type:'get',
        dataType:'json',
        data:{
          token:getCookie("Liutoken"),
          start:0,
          fetchsize:10,
          time:new Date().getTime()
        },
        success:function(data){
             checkToken();
             if(data.rows&&data.rows.length>0){
                  $("#peopleTxt").html(template('peopleList',data));

                  $('#adress').val(data.rows[0].address);        //地址
                  $("#userpic").attr('src',data.rows[0].pic);    //头像
                  $("#userpic").attr('userId',data.rows[0].id);  //id

                  $(".Sex").each(function(i) {
                     if($(this).attr('sex')==$(this).attr('select-sex')){
                          $(this).addClass('active');
                     }
                  });

                  //修改信息状态
                  $(".updateBtn").click(function() {
                      $(this).css("display","none");
                      $('#peopleTxt input').attr('disabled',false).css('border','solid 1px #eee');
                      $('#username').focus();
                      $('.saveBtn').css('display','block');
                      $('.Sex').css('display','inline-block');
                      $('.Sex').css({'background':'#eee','color':'#333'});
                      $('.Sex').eq(1).css('display','none');
                      $('.Sex.active').css({'background':'#00cfe2','color':'#fff'});
                      $('.Sex').click(function(){
                          $(this).attr('id','userSex');
                          $(this).addClass('active').siblings().removeClass('active');
                          $(this).css({'background':'#00cfe2','color':'#fff'}).siblings().css({'background':'#eee','color':'#333','display':'inline-block'});
                          $('.Sex').eq(1).css('display','none');
                      });

                  });
                  $('#updateBtn2').click(function(){
                      $(this).css("display","none");
                      $('.adrs input').attr('disabled',false).css('border','solid 1px #eee');
                      $('#adress').focus();
                      $('.saveTBtn').css('display','block');
                  });

                  //修改用户信息
                  $('.saveBtn').click(function(){

                       var data1={
                            id:$('#userpic').attr('userId'),
                            token:getCookie("Liutoken"),
                            nickName:$('#username').val(),
                            sex:$('#userSex').attr('select-sex'),
                            phone:$('#userphone').val(),
                            time:new Date().getTime()
                       };
                       var reg_phone=/^1[3|4|5|7|8]\d{9}$/;
                       if($('#userphone').val().search(reg_phone)>-1){
                           saveData(data1);
                           $('.saveBtn').css('display','none');
                           $(".updateBtn").css("display",'inline-block');
                       }else{
                          alert('手机号格式不正确!');
                       }
                          $('.Sex.active').css({'background':'none','color':'#00cfe2'});
                          $('.Sex').attr('style','');

                  });

                  $('.saveTBtn').click(function(){
                      var data2={
                          id:$('#userpic').attr('userId'),
                          token:getCookie("Liutoken"),
                          address:$('#adress').val(),
                          time:new Date().getTime()
                      }
                      if($.trim($('#adress').val()).length<=0){
                           alert('快递地址不能为空！');
                      }else{
                          saveData(data2);
                          $('.saveTBtn').css('display','none');
                          $("#updateBtn2").css("display","inline-block");
                      }
                  })
             }else{
                   $("#peopleTxt").html('暂无用户信息！');
             }
        }
    });

    //修改用户信息
    function saveData(datas){
        $.ajax({
             url:'http://book.798artplus.com/api/v1/012',
             type:'get',
             dataType:'json',
             data:datas,
             success:function(data){
                 if(data.message=="success"){
                    $('.main input').attr('disabled',true).css('border','none');
                    $('#adress').attr('disbled',true).css('border','none');
                 }else{
                   alert(data.message);
                 }
             }
        });
    };
     //解析url获取-数据
    var status=getQueryString('status');
    var Idval=getQueryString('fromApplyId');
    var bookimage=getQueryString('bookImage');
    var bookname=decodeURI(getQueryString('bookName'));
    var authorname=decodeURI(getQueryString("authorName"));    //作者
    var bublisher=decodeURI(getQueryString("bublisher"));      //出版社
    var des=decodeURI(getQueryString('des'));                  //简介
    var obj={
           data:{
            "status":status,
            "Idval":Idval,
            "bookimage":bookimage,
            "bookname":bookname,
            "authorname":authorname,
            "bublisher":bublisher,
            "des":des
           }
    }
    $("#bookNews").html(template('bookNews_box',obj));

    if(obj.data.status=="2-3"){
        $("#driver_more").html('<a href="javascript:;" class="btnJoin1">已寄出</a>'
           +'<a href="javascript:;" class="adressbtn">查看物流详情</a>'
           +'<span> 对方确认收到三天后退款</span>'
           +'<p class="adressNews"></p>');

        //得到快递的物流信息(toApplyId，token )
        $('.adressbtn').on("click",function(){
            $.ajax({
                url:'http://book.798artplus.com//api/v1/0151',
                type:'get',
                dataType:'json',
                data:{
                   fromApplyId:Idval,
                   token:getCookie("Liutoken")
                },
                success:function(data){
                    if(data.message=="success"){
                       $(".adressNews").css('display','block');
                       for(var i=0;i<data.rows.length;i++){
                        $(".adressNews").append("<span>"+data.rows[i].context+"<i>"+data.rows[i].time+"</i></span>");
                       }
                       $(this).css('display','none');
                    }else{
                        $(".adressNews").html("暂时没有查询到物流信息！");
                    }
                }
            });
        });

    }else if(obj.data.status=="2"){
        $("#driver_more").html('<a href="javascript:;" class="btnJoin1">邮寄中</a>'
           +'<a href="javascript:;" class="adressbtn">查看物流详情</a>'
           +'<p class="adressNews"></p>');

        //得到快递的物流信息(toApplyId，token )
        $('.adressbtn').on("click",function(){
            $.ajax({
                url:'http://book.798artplus.com/api/v1/0152',
                type:'get',
                dataType:'json',
                data:{
                   toApplyId:Idval,
                   token:getCookie("Liutoken")
                },
                success:function(data){
                    if(data.message=="success"){
                       $(".adressNews").css('display','block');
                       for(var i=0;i<data.rows.length;i++){
                        $(".adressNews").append("<span>"+data.rows[i].context+"<i>"+data.rows[i].time+"</i></span>");
                       }
                    }else{
                        $(".adressNews").html("暂时没有查询到物流信息！");
                    }
                }
            });
        });

    }else if(obj.data.status=="2-2"){
        $("#driver_more").html('<a href="javascript:;" class="btnJoin1">待寄出</a>'
           +'<a href="SetOut_Address.html" class="adressbtn">查看寄出地址</a>'
           +'<p class="selectadressNews"></p>');
    }else if(obj.data.status=="1"){
        $("#driver_more").html('<a href="javascript:;" class="btnJoin1">待审批</a>'
            +'<span> 预计2小时候审批</span>');
    }
})
</script> -->
</body>
</html>
